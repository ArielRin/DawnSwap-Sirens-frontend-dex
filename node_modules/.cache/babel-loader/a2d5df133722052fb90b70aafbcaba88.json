{"ast":null,"code":"import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _toConsumableArray from\"C:/projects/panther-frontend-dex1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"C:/projects/panther-frontend-dex1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{ETHER}from'@pantherswap-libs/sdk';import React,{useCallback,useContext,useEffect,useMemo,useRef,useState}from'react';import{Text,CloseIcon}from'@pantherswap-libs/uikit';import{useSelector}from'react-redux';import{useTranslation}from'react-i18next';import{ThemeContext}from'styled-components';import AutoSizer from'react-virtualized-auto-sizer';import{useActiveWeb3React}from'../../hooks';import{useAllTokens,useToken}from'../../hooks/Tokens';import{useSelectedListInfo}from'../../state/lists/hooks';import{LinkStyledButton,TYPE}from'../Shared';import{isAddress}from'../../utils';import Card from'../Card';import Column from'../Column';import ListLogo from'../ListLogo';import QuestionHelper from'../QuestionHelper';import Row,{RowBetween}from'../Row';import CommonBases from'./CommonBases';import CurrencyList from'./CurrencyList';import{filterTokens}from'./filtering';import SortButton from'./SortButton';import{useTokenComparator}from'./sorting';import{PaddedColumn,SearchInput,Separator}from'./styleds';import TranslatedText from'../TranslatedText';import{TranslateString}from'../../utils/translateTextHelpers';var Main=TYPE.main;export function CurrencySearch(_ref){var selectedCurrency=_ref.selectedCurrency,onCurrencySelect=_ref.onCurrencySelect,otherSelectedCurrency=_ref.otherSelectedCurrency,showCommonBases=_ref.showCommonBases,onDismiss=_ref.onDismiss,isOpen=_ref.isOpen,onChangeList=_ref.onChangeList;var _useTranslation=useTranslation(),t=_useTranslation.t;var _useActiveWeb3React=useActiveWeb3React(),chainId=_useActiveWeb3React.chainId;var theme=useContext(ThemeContext);var fixedList=useRef();var _useState=useState(''),_useState2=_slicedToArray(_useState,2),searchQuery=_useState2[0],setSearchQuery=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),invertSearchOrder=_useState4[0],setInvertSearchOrder=_useState4[1];var allTokens=useAllTokens();// if they input an address, use it\nvar isAddressSearch=isAddress(searchQuery);var searchToken=useToken(searchQuery);var showETH=useMemo(function(){var s=searchQuery.toLowerCase().trim();return s===''||s==='e'||s==='et'||s==='eth';},[searchQuery]);var tokenComparator=useTokenComparator(invertSearchOrder);var audioPlay=useSelector(function(state){return state.user.audioPlay;});var filteredTokens=useMemo(function(){if(isAddressSearch)return searchToken?[searchToken]:[];return filterTokens(Object.values(allTokens),searchQuery);},[isAddressSearch,searchToken,allTokens,searchQuery]);var filteredSortedTokens=useMemo(function(){if(searchToken)return[searchToken];var sorted=filteredTokens.sort(tokenComparator);var symbolMatch=searchQuery.toLowerCase().split(/\\s+/).filter(function(s){return s.length>0;});if(symbolMatch.length>1)return sorted;return[].concat(_toConsumableArray(searchToken?[searchToken]:[]),_toConsumableArray(sorted.filter(function(token){var _token$symbol;return((_token$symbol=token.symbol)===null||_token$symbol===void 0?void 0:_token$symbol.toLowerCase())===symbolMatch[0];})),_toConsumableArray(sorted.filter(function(token){var _token$symbol2;return((_token$symbol2=token.symbol)===null||_token$symbol2===void 0?void 0:_token$symbol2.toLowerCase())!==symbolMatch[0];})));},[filteredTokens,searchQuery,searchToken,tokenComparator]);var handleCurrencySelect=useCallback(function(currency){onCurrencySelect(currency);onDismiss();if(audioPlay){var audio=document.getElementById('bgMusic');if(audio){audio.play();}}},[onDismiss,onCurrencySelect,audioPlay]);// clear the input on open\nuseEffect(function(){if(isOpen)setSearchQuery('');},[isOpen]);// manage focus on modal show\nvar inputRef=useRef();var handleInput=useCallback(function(event){var _fixedList$current;var input=event.target.value;var checksummedInput=isAddress(input);setSearchQuery(checksummedInput||input);(_fixedList$current=fixedList.current)===null||_fixedList$current===void 0?void 0:_fixedList$current.scrollTo(0);},[]);var handleEnter=useCallback(function(e){if(e.key==='Enter'){var s=searchQuery.toLowerCase().trim();if(s==='eth'){handleCurrencySelect(ETHER);}else if(filteredSortedTokens.length>0){var _filteredSortedTokens;if(((_filteredSortedTokens=filteredSortedTokens[0].symbol)===null||_filteredSortedTokens===void 0?void 0:_filteredSortedTokens.toLowerCase())===searchQuery.trim().toLowerCase()||filteredSortedTokens.length===1){handleCurrencySelect(filteredSortedTokens[0]);}}}},[filteredSortedTokens,handleCurrencySelect,searchQuery]);var selectedListInfo=useSelectedListInfo();return/*#__PURE__*/_jsxs(Column,{style:{width:'100%',flex:'1 1'},children:[/*#__PURE__*/_jsxs(PaddedColumn,{gap:\"14px\",children:[/*#__PURE__*/_jsxs(RowBetween,{children:[/*#__PURE__*/_jsxs(Text,{children:[/*#__PURE__*/_jsx(TranslatedText,{translationId:82,children:\"Select a token\"}),/*#__PURE__*/_jsx(QuestionHelper,{text:TranslateString(130,'Find a token by searching for its name or symbol or by pasting its address below.')})]}),/*#__PURE__*/_jsx(CloseIcon,{onClick:onDismiss})]}),/*#__PURE__*/_jsx(SearchInput,{type:\"text\",id:\"token-search-input\",placeholder:t('tokenSearchPlaceholder'),value:searchQuery,ref:inputRef,onChange:handleInput,onKeyDown:handleEnter}),showCommonBases&&/*#__PURE__*/_jsx(CommonBases,{chainId:chainId,onSelect:handleCurrencySelect,selectedCurrency:selectedCurrency}),/*#__PURE__*/_jsxs(RowBetween,{children:[/*#__PURE__*/_jsx(Text,{fontSize:\"14px\",children:/*#__PURE__*/_jsx(TranslatedText,{translationId:126,children:\"Token name\"})}),/*#__PURE__*/_jsx(SortButton,{ascending:invertSearchOrder,toggleSortOrder:function toggleSortOrder(){return setInvertSearchOrder(function(iso){return!iso;});}})]})]}),/*#__PURE__*/_jsx(Separator,{}),/*#__PURE__*/_jsx(\"div\",{style:{flex:'1'},children:/*#__PURE__*/_jsx(AutoSizer,{disableWidth:true,children:function children(_ref2){var height=_ref2.height;return/*#__PURE__*/_jsx(CurrencyList,{height:height,showETH:showETH,currencies:filteredSortedTokens,onCurrencySelect:handleCurrencySelect,otherCurrency:otherSelectedCurrency,selectedCurrency:selectedCurrency,fixedListRef:fixedList});}})}),null&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Separator,{}),/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(RowBetween,{children:[selectedListInfo.current?/*#__PURE__*/_jsxs(Row,{children:[selectedListInfo.current.logoURI?/*#__PURE__*/_jsx(ListLogo,{style:{marginRight:12},logoURI:selectedListInfo.current.logoURI,alt:\"\".concat(selectedListInfo.current.name,\" list logo\")}):null,/*#__PURE__*/_jsx(Main,{id:\"currency-search-selected-list-name\",children:selectedListInfo.current.name})]}):null,/*#__PURE__*/_jsx(LinkStyledButton,{style:{fontWeight:500,color:theme.colors.textSubtle,fontSize:16},onClick:onChangeList,id:\"currency-search-change-list-button\",children:selectedListInfo.current?'Change':'Select a list'})]})})]})]});}export default CurrencySearch;","map":{"version":3,"sources":["C:/projects/panther-frontend-dex1/src/components/SearchModal/CurrencySearch.tsx"],"names":["ETHER","React","useCallback","useContext","useEffect","useMemo","useRef","useState","Text","CloseIcon","useSelector","useTranslation","ThemeContext","AutoSizer","useActiveWeb3React","useAllTokens","useToken","useSelectedListInfo","LinkStyledButton","TYPE","isAddress","Card","Column","ListLogo","QuestionHelper","Row","RowBetween","CommonBases","CurrencyList","filterTokens","SortButton","useTokenComparator","PaddedColumn","SearchInput","Separator","TranslatedText","TranslateString","Main","main","CurrencySearch","selectedCurrency","onCurrencySelect","otherSelectedCurrency","showCommonBases","onDismiss","isOpen","onChangeList","t","chainId","theme","fixedList","searchQuery","setSearchQuery","invertSearchOrder","setInvertSearchOrder","allTokens","isAddressSearch","searchToken","showETH","s","toLowerCase","trim","tokenComparator","audioPlay","state","user","filteredTokens","Object","values","filteredSortedTokens","sorted","sort","symbolMatch","split","filter","length","token","symbol","handleCurrencySelect","currency","audio","document","getElementById","play","inputRef","handleInput","event","input","target","value","checksummedInput","current","scrollTo","handleEnter","e","key","selectedListInfo","width","flex","iso","height","logoURI","marginRight","name","fontWeight","color","colors","textSubtle","fontSize"],"mappings":"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","sourcesContent":["import { Currency, ETHER, Token } from '@pantherswap-libs/sdk'\r\nimport React, { KeyboardEvent, RefObject, useCallback, useContext, useEffect, useMemo, useRef, useState } from 'react'\r\nimport { Text, CloseIcon } from '@pantherswap-libs/uikit'\r\nimport { useSelector } from 'react-redux'\r\nimport { useTranslation } from 'react-i18next'\r\nimport { FixedSizeList } from 'react-window'\r\nimport { ThemeContext } from 'styled-components'\r\nimport AutoSizer from 'react-virtualized-auto-sizer'\r\nimport { useActiveWeb3React } from '../../hooks'\r\nimport { AppState } from '../../state'\r\nimport { useAllTokens, useToken } from '../../hooks/Tokens'\r\nimport { useSelectedListInfo } from '../../state/lists/hooks'\r\nimport { LinkStyledButton, TYPE } from '../Shared'\r\nimport { isAddress } from '../../utils'\r\nimport Card from '../Card'\r\nimport Column from '../Column'\r\nimport ListLogo from '../ListLogo'\r\nimport QuestionHelper from '../QuestionHelper'\r\nimport Row, { RowBetween } from '../Row'\r\nimport CommonBases from './CommonBases'\r\nimport CurrencyList from './CurrencyList'\r\nimport { filterTokens } from './filtering'\r\nimport SortButton from './SortButton'\r\nimport { useTokenComparator } from './sorting'\r\nimport { PaddedColumn, SearchInput, Separator } from './styleds'\r\nimport TranslatedText from '../TranslatedText'\r\nimport { TranslateString } from '../../utils/translateTextHelpers'\r\n\r\nconst { main: Main } = TYPE\r\n\r\ninterface CurrencySearchProps {\r\n  isOpen: boolean\r\n  onDismiss: () => void\r\n  selectedCurrency?: Currency | null\r\n  onCurrencySelect: (currency: Currency) => void\r\n  otherSelectedCurrency?: Currency | null\r\n  showCommonBases?: boolean\r\n  onChangeList: () => void\r\n}\r\n\r\nexport function CurrencySearch({\r\n  selectedCurrency,\r\n  onCurrencySelect,\r\n  otherSelectedCurrency,\r\n  showCommonBases,\r\n  onDismiss,\r\n  isOpen,\r\n  onChangeList,\r\n}: CurrencySearchProps) {\r\n  const { t } = useTranslation()\r\n  const { chainId } = useActiveWeb3React()\r\n  const theme = useContext(ThemeContext)\r\n\r\n  const fixedList = useRef<FixedSizeList>()\r\n  const [searchQuery, setSearchQuery] = useState<string>('')\r\n  const [invertSearchOrder, setInvertSearchOrder] = useState<boolean>(false)\r\n  const allTokens = useAllTokens()\r\n\r\n  // if they input an address, use it\r\n  const isAddressSearch = isAddress(searchQuery)\r\n  const searchToken = useToken(searchQuery)\r\n\r\n  const showETH: boolean = useMemo(() => {\r\n    const s = searchQuery.toLowerCase().trim()\r\n    return s === '' || s === 'e' || s === 'et' || s === 'eth'\r\n  }, [searchQuery])\r\n\r\n  const tokenComparator = useTokenComparator(invertSearchOrder)\r\n\r\n  const audioPlay = useSelector<AppState, AppState['user']['audioPlay']>((state) => state.user.audioPlay)\r\n\r\n  const filteredTokens: Token[] = useMemo(() => {\r\n    if (isAddressSearch) return searchToken ? [searchToken] : []\r\n    return filterTokens(Object.values(allTokens), searchQuery)\r\n  }, [isAddressSearch, searchToken, allTokens, searchQuery])\r\n\r\n  const filteredSortedTokens: Token[] = useMemo(() => {\r\n    if (searchToken) return [searchToken]\r\n    const sorted = filteredTokens.sort(tokenComparator)\r\n    const symbolMatch = searchQuery\r\n      .toLowerCase()\r\n      .split(/\\s+/)\r\n      .filter((s) => s.length > 0)\r\n    if (symbolMatch.length > 1) return sorted\r\n\r\n    return [\r\n      ...(searchToken ? [searchToken] : []),\r\n      // sort any exact symbol matches first\r\n      ...sorted.filter((token) => token.symbol?.toLowerCase() === symbolMatch[0]),\r\n      ...sorted.filter((token) => token.symbol?.toLowerCase() !== symbolMatch[0]),\r\n    ]\r\n  }, [filteredTokens, searchQuery, searchToken, tokenComparator])\r\n\r\n  const handleCurrencySelect = useCallback(\r\n    (currency: Currency) => {\r\n      onCurrencySelect(currency)\r\n      onDismiss()\r\n      if (audioPlay) {\r\n        const audio = document.getElementById('bgMusic') as HTMLAudioElement\r\n        if (audio) {\r\n          audio.play()\r\n        }\r\n      }\r\n    },\r\n    [onDismiss, onCurrencySelect, audioPlay]\r\n  )\r\n\r\n  // clear the input on open\r\n  useEffect(() => {\r\n    if (isOpen) setSearchQuery('')\r\n  }, [isOpen])\r\n\r\n  // manage focus on modal show\r\n  const inputRef = useRef<HTMLInputElement>()\r\n  const handleInput = useCallback((event) => {\r\n    const input = event.target.value\r\n    const checksummedInput = isAddress(input)\r\n    setSearchQuery(checksummedInput || input)\r\n    fixedList.current?.scrollTo(0)\r\n  }, [])\r\n\r\n  const handleEnter = useCallback(\r\n    (e: KeyboardEvent<HTMLInputElement>) => {\r\n      if (e.key === 'Enter') {\r\n        const s = searchQuery.toLowerCase().trim()\r\n        if (s === 'eth') {\r\n          handleCurrencySelect(ETHER)\r\n        } else if (filteredSortedTokens.length > 0) {\r\n          if (\r\n            filteredSortedTokens[0].symbol?.toLowerCase() === searchQuery.trim().toLowerCase() ||\r\n            filteredSortedTokens.length === 1\r\n          ) {\r\n            handleCurrencySelect(filteredSortedTokens[0])\r\n          }\r\n        }\r\n      }\r\n    },\r\n    [filteredSortedTokens, handleCurrencySelect, searchQuery]\r\n  )\r\n\r\n  const selectedListInfo = useSelectedListInfo()\r\n\r\n  return (\r\n    <Column style={{ width: '100%', flex: '1 1' }}>\r\n      <PaddedColumn gap=\"14px\">\r\n        <RowBetween>\r\n          <Text>\r\n            <TranslatedText translationId={82}>Select a token</TranslatedText>\r\n            <QuestionHelper\r\n              text={TranslateString(\r\n                130,\r\n                'Find a token by searching for its name or symbol or by pasting its address below.'\r\n              )}\r\n            />\r\n          </Text>\r\n          <CloseIcon onClick={onDismiss} />\r\n        </RowBetween>\r\n        <SearchInput\r\n          type=\"text\"\r\n          id=\"token-search-input\"\r\n          placeholder={t('tokenSearchPlaceholder')}\r\n          value={searchQuery}\r\n          ref={inputRef as RefObject<HTMLInputElement>}\r\n          onChange={handleInput}\r\n          onKeyDown={handleEnter}\r\n        />\r\n        {showCommonBases && (\r\n          <CommonBases chainId={chainId} onSelect={handleCurrencySelect} selectedCurrency={selectedCurrency} />\r\n        )}\r\n        <RowBetween>\r\n          <Text fontSize=\"14px\">\r\n            <TranslatedText translationId={126}>Token name</TranslatedText>\r\n          </Text>\r\n          <SortButton ascending={invertSearchOrder} toggleSortOrder={() => setInvertSearchOrder((iso) => !iso)} />\r\n        </RowBetween>\r\n      </PaddedColumn>\r\n\r\n      <Separator />\r\n\r\n      <div style={{ flex: '1' }}>\r\n        <AutoSizer disableWidth>\r\n          {({ height }) => (\r\n            <CurrencyList\r\n              height={height}\r\n              showETH={showETH}\r\n              currencies={filteredSortedTokens}\r\n              onCurrencySelect={handleCurrencySelect}\r\n              otherCurrency={otherSelectedCurrency}\r\n              selectedCurrency={selectedCurrency}\r\n              fixedListRef={fixedList}\r\n            />\r\n          )}\r\n        </AutoSizer>\r\n      </div>\r\n\r\n      {null && (\r\n        <>\r\n          <Separator />\r\n          <Card>\r\n            <RowBetween>\r\n              {selectedListInfo.current ? (\r\n                <Row>\r\n                  {selectedListInfo.current.logoURI ? (\r\n                    <ListLogo\r\n                      style={{ marginRight: 12 }}\r\n                      logoURI={selectedListInfo.current.logoURI}\r\n                      alt={`${selectedListInfo.current.name} list logo`}\r\n                    />\r\n                  ) : null}\r\n                  <Main id=\"currency-search-selected-list-name\">{selectedListInfo.current.name}</Main>\r\n                </Row>\r\n              ) : null}\r\n              <LinkStyledButton\r\n                style={{ fontWeight: 500, color: theme.colors.textSubtle, fontSize: 16 }}\r\n                onClick={onChangeList}\r\n                id=\"currency-search-change-list-button\"\r\n              >\r\n                {selectedListInfo.current ? 'Change' : 'Select a list'}\r\n              </LinkStyledButton>\r\n            </RowBetween>\r\n          </Card>\r\n        </>\r\n      )}\r\n    </Column>\r\n  )\r\n}\r\n\r\nexport default CurrencySearch\r\n"]},"metadata":{},"sourceType":"module"}